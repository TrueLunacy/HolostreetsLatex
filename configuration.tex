% configuration.tex is catch-all 'doing things'
% it's executed second last, before the background

\etocsettocstyle
{
}
{
}

\patchcmd{\chapter}{\thispagestyle{plain}}{\thispagestyle{fancy}}{}{}

\renewcommand{\chaptermark}[1]{\InsertMark{chapter}{#1}\InsertMark{section}{}\InsertMark{isChapter}{1}\InsertMark{isChapter}{0}}
\renewcommand{\sectionmark}[1]{\InsertMark{section}{#1}}

\renewenvironment{FlushLeft}{%
   \topsep=0pt
   \partopsep=0pt
   \trivlist%
   \RaggedRight\item\relax
   }{%
   \endtrivlist%
}

\newcommand{\@nullify}[1]{}

\titleformat{\chapter}[display]{\hyphenpenalty=10000\centering\color{chaptercolor}\fontsize{60pt}{70pt}\headerfont}{}{0pt}{\@nullify}
\titlespacing{\chapter}{0pt}{130pt}{90pt}
\titleformat{\section}[hang]{\hyphenpenalty=10000\color{sectioncolor}\headerfont\huge\RaggedRight}{}{0pt}{\MakeUppercase}[\ifdefined\@headerrule\hrule\fi]
\titleformat{\subsection}[hang]{\hyphenpenalty=10000\color{subsectioncolor}\headerfont\Large\RaggedRight}{}{0pt}{\MakeUppercase}[\ifdefined\@headerrule\hrule\fi]
\titleformat{\subsubsection}[hang]{\hyphenpenalty=10000\color{subsectioncolor}\headerfont\normalsize\RaggedRight}{}{0pt}{\MakeUppercase}[\ifdefined\@headerrule\hrule\fi]
\titlespacing{\section}{0pt}{8pt plus 8pt minus 8pt}{\@postheaderlength}
\titlespacing{\subsection}{0pt}{8pt plus 8pt minus 8pt}{\@postheaderlength}
\titlespacing{\subsubsection}{0pt}{8pt plus 8pt minus 8pt}{\@postheaderlength}


\newcommand{\leftoddmark}
{

    %\expandafter\ifblank{\FirstMark{chapter}}
    %    {No Chapter}
    %    {Yes Chapter - '\FirstMark{chapter}'}
    %\def\HUH{huh}
    %\ifthenelse{\equal{\HUH}{FUCK}}
    %{
    %}
    %{
    %    
    %}
    %\ifthenelse{\equal{WHAT}{FUCK}}
    %    {No Chapter}
    %    {Chapter}

    %\IfMarksEqualTF{section}{top}{first}
    %\ifstrempty{\FirstMark{chapter}}
    %{
    %    No Chapter
        %\ifthenelse{\equal{\LastMark{section}}{}}
        %{ %both are empty, do nothing
    %
        %}
        %{ % we have section but not chapter
        %    \large\LastMark{section}
        %}
    %}
    %{
        %\ifthenelse{\equal{\LastMark{section}}{}}
        %{ % we have chapter but not section
        %    \FirstMark{chapter}
        %}
        %{ % we have both
        %    \FirstMark{chapter}\space//\space\large\LastMark{section}
        %}
    %}
}
%
%\newcommand{\rightevenmark}
%{
%    \ifthenelse{\equal{\FirstMark{chapter}}{}}
%    {
%        \ifthenelse{\equal{\LastMark{section}}{}}
%        { %both are empty, do nothing
%
%        }
%        { % we have section but not chapter
%            \large\LastMark{section}
%        }
%    }
%    {
%        \ifthenelse{\equal{\LastMark{section}}{}}
%        { % we have chapter but not section
%            \FirstMark{chapter}
%        }
%        { % we have both
%            \large\LastMark{section}\space//\space\normalsize\FirstMark{chapter}
%        }
%    }
%}

\AtBeginDocument{
    \pagenumbering{arabic}
    \InsertMark{isChapter}{0}
    \InsertMark{drawBackground}{1}
    \InsertMark{drawPageNumber}{0}

    \fancypagestyle{plain}
    {
        \fancyhf{}
        \fancyfoot[LO]{\headerfont\color{corecolor}\MakeUppercase{\leftoddmark}}
        \fancyfoot[RE]{\headerfont\color{corecolor}\MakeUppercase{\leftoddmark}}
    }

    \fancypagestyle{titlepage}[plain]
    {
        \fancyhf{}
    }

    \pagestyle{plain}
}

\renewcommand*{\maketitle}
{
    \begin{titlepage}
        \pagenumbering{Alph}
        \thispagestyle{titlepage}
        \InsertMark{drawPageNumber}{0}
        \InsertMark{drawBackground}{0}
        \null
        \clearpage
        \InsertMark{drawBackground}{1}
        \InsertMark{drawPageNumber}{1}
        \pagenumbering{arabic}
    \end{titlepage}
}

\pretocmd{\tableofcontents}
{
    \InsertMark{drawPageNumber}{0}
}{}{}

\apptocmd{\tableofcontents}
{
    \ifdefined\@openingAny
        \clearpage
    \else
        \cleardoublepage
    \fi
    \beginnumbering
}{}{}